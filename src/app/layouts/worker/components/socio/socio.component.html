<div class="socio-container">
  <div class="toolbar">
    <mat-form-field appearance="outline" class="search-field">
      <input
        matInput
        placeholder="Buscar por nombre, apellidos, DNI, teléfono o colegio"
        [formControl]="searchTermControl"
      />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <button
      mat-raised-button
      color="primary"
      (click)="openAddDialog()"
      class="add-button"
    >
      <mat-icon>add</mat-icon>
      Agregar Socio
    </button>
  </div>

  <div class="socio-table">
    <div class="table-header">
      <span data-label="NOMBRE">NOMBRE</span>
      <span data-label="APELLIDOS">APELLIDOS</span>
      <span data-label="DNI">DNI</span>
      <span data-label="TELÉFONO">TELÉFONO</span>
      <span data-label="CONTRASEÑA">CONTRASEÑA</span>
      <span data-label="COLEGIOS">COLEGIOS</span>
      <span data-label="IDS_COLEGIOS">IDs COLEGIOS</span>
      <span data-label="ACCIONES">ACCIONES</span>
    </div>

    <div class="table-body">
      <div *ngIf="loading" class="loading-container">
        <div class="loading">Cargando datos <span class="spinner"></span></div>
      </div>

      <div *ngIf="error && !loading" class="error-container">
        <div class="error-message">
          <mat-icon class="error-icon">error_outline</mat-icon>
          <p>{{ error }}</p>
          <button mat-raised-button color="primary" (click)="refreshSocios()">
            <mat-icon>refresh</mat-icon>
            Reintentar
          </button>
        </div>
      </div>

      <div
        class="socio-row"
        *ngFor="let socio of filteredSocios; trackBy: trackBySocioId"
      >
        <span data-label="NOMBRE">{{ socio.nombre || "N/A" }}</span>
        <span data-label="APELLIDOS">{{ socio.apellidos || "N/A" }}</span>
        <span data-label="DNI">{{ socio.dni || "N/A" }}</span>
        <span data-label="TELÉFONO">{{ socio.telefono || "N/A" }}</span>
        <span data-label="CONTRASEÑA">{{ socio.contrasena || "Sin contraseña" }}</span>
        <span data-label="COLEGIOS" class="colegios-field">
          {{ socio.nomColegios }}
        </span>
        <span data-label="IDS_COLEGIOS" class="ids-field">
          <span
            *ngFor="let id of socio.idColegios; let last = last"
            class="id-badge"
          >
            {{ id }}<span *ngIf="!last">, </span>
          </span>
        </span>

        <span class="actions" data-label="ACCIONES">
          <mat-icon
            (click)="editSocio(socio)"
            style="color: #ffcc00; cursor: pointer"
            title="Editar"
            matTooltip="Editar socio"
          >
            edit
          </mat-icon>
          <mat-icon
            (click)="confirmDelete(socio)"
            style="color: #f44336"
            title="Eliminar"
            matTooltip="Eliminar socio"
          >
            delete
          </mat-icon>
        </span>
      </div>

      <div
        *ngIf="filteredSocios.length === 0 && !loading && !error"
        class="empty-state"
      >
        <mat-icon class="empty-icon">person</mat-icon>
        <p
          *ngIf="
            searchTermControl.value && searchTermControl.value.trim() !== ''
          "
        >
          No se encontraron socios que coincidan con "<strong>{{
            searchTermControl.value
          }}</strong
          >"
        </p>
        <p
          *ngIf="
            !searchTermControl.value || searchTermControl.value.trim() === ''
          "
        >
          No hay socios registrados para este colegio
        </p>
        <button
          mat-raised-button
          color="primary"
          (click)="openAddDialog()"
          *ngIf="
            !searchTermControl.value || searchTermControl.value.trim() === ''
          "
        >
          <mat-icon>add</mat-icon>
          Agregar primer socio
        </button>
        <button
          mat-raised-button
          color="basic"
          (click)="clearSearch()"
          *ngIf="
            searchTermControl.value && searchTermControl.value.trim() !== ''
          "
        >
          <mat-icon>clear</mat-icon>
          Limpiar búsqueda
        </button>
      </div>
    </div>
  </div>
</div>
