<div class="container">
  <mat-toolbar color="primary">
    <button mat-icon-button (click)="onBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <span class="title">Crear Nuevo Anuncio</span>
  </mat-toolbar>

  <div class="form-container" *ngIf="isBrowser">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Información del Anuncio</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="comunicadoForm" (ngSubmit)="onSubmit()">
          <!-- Salón -->
          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Salón</mat-label>
            <mat-select formControlName="idSalon" required>
              <mat-option *ngFor="let salon of salones" [value]="salon.id">
                {{ salon.nombre }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="comunicadoForm.get('idSalon')?.hasError('required')">
              Selecciona un salón
            </mat-error>
          </mat-form-field>

          <!-- Nombre -->
          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Nombre del Anuncio</mat-label>
            <input matInput formControlName="nombre" placeholder="Ej: Reunión de padres" required>
            <mat-error *ngIf="comunicadoForm.get('nombre')?.hasError('required')">
              El nombre es requerido
            </mat-error>
          </mat-form-field>

          <!-- Horario -->
          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Horario</mat-label>
            <input matInput formControlName="horario" placeholder="Ej: Lunes 15:00 - 16:00" required>
            <mat-error *ngIf="comunicadoForm.get('horario')?.hasError('required')">
              El horario es requerido
            </mat-error>
          </mat-form-field>

          <!-- PDF -->
          <div class="pdf-upload">
            <div class="pdf-preview" *ngIf="pdfFile">
              <span>{{ pdfFile.name }}</span>
              <button mat-icon-button color="warn" (click)="pdfFile = null; uploadProgress = 0" class="remove-button">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            <input #fileInput type="file" (change)="onPdfUpload($event)" accept="application/pdf" class="file-input" required>
            <button mat-raised-button color="primary" (click)="triggerFileInput()" [disabled]="loading">
              {{ pdfFile ? 'Cambiar PDF' : 'Seleccionar PDF' }}
            </button>
            <div *ngIf="uploadProgress > 0 && uploadProgress < 100" class="progress">
              <mat-progress-bar mode="determinate" [value]="uploadProgress"></mat-progress-bar>
              <span>Subiendo: {{ uploadProgress }}%</span>
            </div>
          </div>

          <!-- Mensajes de error/éxito -->
          <mat-error *ngIf="error" class="error-message">{{ error }}</mat-error>
          <mat-hint *ngIf="successMessage" class="success-message">{{ successMessage }}</mat-hint>

          <!-- Botón de envío -->
          <button mat-raised-button color="primary" type="submit" [disabled]="loading" class="submit-button">
            <mat-icon *ngIf="loading">autorenew</mat-icon>
            Publicar Anuncio
          </button>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
